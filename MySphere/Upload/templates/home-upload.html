<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'home.css' %}" type="text/css" rel="stylesheet">
    <link href="{% static 'side.css' %}" type="text/css" rel="stylesheet">
    <link href="{% static 'loader.css'%}" type="text/css" rel="stylesheet">
    <title>Home</title>
</head>
<body>
    <div class="sidebar">
        <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" height="60px" viewBox="0 -960 960 960" width="60px"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm-40-82v-78q-33 0-56.5-23.5T360-320v-40L168-552q-3 18-5.5 36t-2.5 36q0 121 79.5 212T440-162Zm276-102q41-45 62.5-100.5T800-480q0-98-54.5-179T600-776v16q0 33-23.5 56.5T520-680h-80v80q0 17-11.5 28.5T400-560h-80v80h240q17 0 28.5 11.5T600-440v120h40q26 0 47 15.5t29 40.5Z"/></svg>
        </div>
        <div class="sidebar-content">
            <div style="display: flex; align-items: center;">
                <a href="/files/">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z"/></svg>
                    <h2 style="display: inline-flex; margin-left: 5px;" class="link-side">Home</h2>
                </a>
            </div>
            <div style="display: flex; align-items: center;">
                <a href="/upload/">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M440-320v-326L336-542l-56-58 200-200 200 200-56 58-104-104v326h-80ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/></svg>
                    <h2 style="display: inline-flex; margin-left: 5px;" class="link-side">Upload</h2>
                </a>
            </div>
            <div style="display: flex; align-items: center;">
                <a href="/folder/">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640v400q0 33-23.5 56.5T800-160H160Zm0-80h640v-400H447l-80-80H160v480Zm0 0v-480 480Z"/></svg>
                    <h2 style="display: inline-flex; margin-left: 5px;" class="link-side">Folder</h2>
                </a>
            </div>
            <div style="display: flex; align-items: center;">
                <a href="/usb/">
                    <svg style="display: inline-flex;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-80q-33 0-56.5-23.5T400-160q0-21 11-39t29-29v-92H320q-33 0-56.5-23.5T240-400v-92q-18-9-29-27t-11-41q0-33 23.5-56.5T280-640q33 0 56.5 23.5T360-560q0 23-11 40t-29 28v92h120v-320h-80l120-160 120 160h-80v320h120v-80h-40v-160h160v160h-40v80q0 33-23.5 56.5T640-320H520v92q19 10 29.5 28t10.5 40q0 33-23.5 56.5T480-80Z"/></svg>
                    <h2 style="display: inline-flex; margin-left: 5px;" class="link-side">USB</h2>
                </a>
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <h1 style="user-select: none;">
            <svg class="back" onclick="back()" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z"/></svg>
            Upload: {{shortPath}}
        </h1>
        <input type="file" id="upload-file" required>
        <button class="video-button" onclick="uploadFile()">
            Upload
        </button>
        <br><br>
        <div style="display: none;" id="loader">
            <div class="loader" style="margin: auto;"></div>
        </div>
        {% for dir in directories %}
            <div class="folder-item">
                <div style="display: inline-block;">
                    <div class="folder-circle">
                        <svg class="folder-icon" style="margin: auto;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="20px"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640v400q0 33-23.5 56.5T800-160H160Zm0-80h640v-400H447l-80-80H160v480Zm0 0v-480 480Z"/></svg>
                    </div>
                </div>
                <div style="display: inline-block; position: relative; bottom: 6px; margin-left: 5px;">
                    <a href="/upload/home/{{dir.2}}" style="font-size: 20px;">{{dir.1}}</a>
                </div>
            </div>
            <br>
        {% endfor %}
    </div>
    {% csrf_token %}
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');

        function uploadFile() {
            var fileInput = document.getElementById("upload-file");
            var formData = new FormData();
            
            if (fileInput.files.length === 0) {
                alert("Please select a file before uploading.");
                return;
            }
            
            formData.append("file", fileInput.files[0]); // Append file
            formData.append("csrfmiddlewaretoken", csrftoken); // CSRF token
            formData.append("path", "{{path}}")

            document.getElementById("loader").style = "display: block;"

            fetch("/upload/file-upload/", {  // Make sure this matches your Django URL
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(json => {
                console.log(json);
                alert("File Uploaded");
                document.getElementById("loader").style = "display: none;"
            })
            .catch(error => console.error("Error:", error));
        }

        function back() {
            if ("{{back}}" == "history") {
                window.history.back()
            }
        }
    </script>
</body>
</html>
